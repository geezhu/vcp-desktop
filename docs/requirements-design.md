# VCPInstallerGUI 需求设计文档

**文档版本**: 0.4.0  
**创建日期**: 2026-02-24  
**更新日期**: 2026-02-24  
**状态**: Draft  
**范围**: 仅需求设计，不包含代码实现
**平台策略（临时）**: 跨平台方案冻结，当前阶段仅聚焦 Linux

---

## 1. 背景与目标

当前仓库包含多个可独立运行的子项目（如 `VCPToolBox`、`VCPChat`），本地安装步骤分散在不同文档中，且存在平台差异与依赖复杂度。  
本项目计划新增一个独立的 GUI 安装器子项目，统一完成安装、配置和基础验证流程。

目标：

1. 为使用者提供可视化安装向导，降低命令行门槛。
2. 标准化安装顺序与配置步骤，减少漏配和误配。
3. 输出可追踪日志与诊断信息，便于排障与复现。
4. 支持后续扩展（更多组件、更多插件预设；跨平台能力后续解冻）。
5. 支持 CLI 与 GUI 双模式安装，并保证关键流程一致。

---

## 2. 项目范围

### 2.1 In Scope（本阶段包含）

1. 新建独立项目目录 `VCPInstallerGUI/`。
2. 提供 GUI 与 CLI 双模式安装流程设计（环境检测、安装、配置、验证）。
3. 覆盖核心组件安装：`VCPToolBox`、`VCPChat`。
4. 生成基础配置文件：`VCPToolBox/config.env`（由模板生成）与 `VCPChat/AppData/settings.json`（由向导生成）。
5. 安装完成后的健康检查与结果报告。
6. 在 CLI 模式中，对“必须用户进行 GUI 操作”的步骤提供标准化提示与可恢复继续机制。
7. 配置向导支持“最小配置（默认）+ 高级配置（可选）”双层模式。
8. 本阶段仅定义 Linux 安装闭环（优先 Ubuntu/Debian 系）。

### 2.2 Out of Scope（本阶段不包含）

1. 业务功能开发（聊天、插件能力、面板功能）。
2. 全量插件一键精细化配置（仅提供最小可运行配置）。
3. 云端部署与远程运维能力。
4. 自动修复所有第三方系统依赖问题（仅检测并给出指引）。
5. 在 `headless` 条件下无提示完成所有 GUI 依赖步骤。
6. Windows/macOS 安装器交付（临时冻结，解冻后单独立项评估）。

---

## 3. 用户角色与典型场景

### 3.1 目标用户

1. 首次部署的个人开发者/测试者。
2. 需要快速复现环境的协作者。
3. 不熟悉命令行但需要本地运行项目的使用者。
4. 需要在服务器或远程终端执行安装流程的运维人员。

### 3.2 典型场景

1. 新机器首次安装：从零检测依赖并完成安装。
2. 已有仓库但缺依赖：执行增量安装与修复。
3. 配置丢失或错误：通过向导重建关键配置。
4. 安装后无法启动：查看可读日志并导出诊断结果。
5. 无桌面环境部署：通过 CLI 安装并在必要环节按提示执行人工 GUI 操作后继续。

---

## 4. 功能需求（Functional Requirements）

### FR-001 环境检测

1. 检测 Node.js、npm、Python、pip、Git、可选 Docker、可选 Rust。
2. 显示当前版本、最低要求、是否满足。
3. 对缺失项提供明确修复建议（命令或文档链接占位）。
4. 检测网络可用性（用于包管理下载）并提示风险。

### FR-002 组件选择与安装编排

1. 支持勾选安装组件：`VCPToolBox`、`VCPChat`。
2. 支持顺序执行安装任务（可中断、可重试、可跳过已完成步骤）。
3. 支持显示实时安装日志（stdout/stderr）。
4. 失败时记录失败步骤、命令、退出码、时间戳。

### FR-003 配置向导

1. 基于模板生成 `VCPToolBox/config.env`。
2. 收集最小必填项（例如 API 地址、密钥、服务端口、鉴权键），并将“最小配置”设为默认选项。
3. 生成 `VCPChat` 连接配置（服务器地址、API Key、日志通道配置）。
4. 提供“高级配置”可选入口，默认折叠，不影响首次安装主流程。
5. 高级配置项需按模块分组展示（如网络、插件、性能、安全），并标注“可选”。
6. 未填写高级配置时，安装流程不得阻断；系统应回退到最小配置基线。
7. 提供“一键恢复最小配置”能力，允许用户从高级配置状态快速回到可运行基线。
8. 对敏感字段进行遮罩展示与本地安全保存提示。

### FR-004 安装后验证

1. 校验关键文件是否存在（配置、依赖、必要目录）。
2. 校验关键进程是否可启动（至少进行一次可控启动检查）。
3. 提供“通过/警告/失败”三级结果。
4. 支持导出安装报告（Markdown 或 JSON）。

### FR-005 错误处理与回滚策略

1. 发生错误时不清理用户已有仓库代码。
2. 仅对安装器创建的临时文件执行可控清理。
3. 对每个失败步骤提供“重试当前步骤”和“跳过并继续”选项。
4. 对不可恢复错误提供“人工处理清单”。

### FR-006 可观测性

1. 提供任务时间线（开始时间、结束时间、耗时）。
2. 提供结构化日志级别（INFO/WARN/ERROR）。
3. 提供单次安装会话 ID，便于问题追踪。

### FR-007 执行模式与参数

1. 支持统一安装内核，不同入口运行：GUI 入口与 CLI 入口。
2. CLI 模式支持参数：`--gui`、`--cli`、`--auto`、`--headless`。
3. 不同入口执行同一任务编排定义，避免流程分叉导致结果不一致。
4. 在 `--headless` 模式下遇到 GUI 必需步骤时，不得静默跳过，必须输出明确阻塞原因。

### FR-008 GUI 必需步骤提示与恢复

1. 当步骤被判定为“GUI 必需”时，CLI 必须输出结构化提示，至少包含：`step_id`、原因、用户操作说明、完成判据、继续命令。
2. GUI 必需步骤完成后，系统支持继续执行，不重复已完成步骤。
3. 安装过程需持久化状态快照，支持 `resume` 继续。
4. `resume` 恢复后应校验上下文一致性（路径、组件选择、配置状态）。

---

## 5. 非功能需求（Non-Functional Requirements）

### NFR-001 可用性

1. 首次进入可在 3 分钟内完成向导输入并开始安装。
2. 安装界面状态清晰，不要求用户理解内部实现细节。
3. 默认最小配置路径应可在不展开高级选项的情况下完成安装。

### NFR-002 兼容性

1. 当前阶段目标平台：Linux（x86_64 优先）。  
2. 首发发行版基线：Ubuntu 22.04+ / Debian 12+。  
3. Windows/macOS 跨平台支持处于冻结状态，不纳入本阶段验收。

### NFR-003 可靠性

1. 安装器异常退出后可恢复到最近步骤继续执行。
2. 不应破坏现有用户仓库文件结构。

### NFR-004 安全性

1. 敏感配置不写入公开日志。
2. 日志导出时默认脱敏。
3. 不执行未展示给用户的隐式高风险命令。

### NFR-005 性能

1. 安装器界面交互不卡顿（长任务异步执行）。
2. 日志刷新为流式，不阻塞主界面。

### NFR-006 一致性

1. GUI 与 CLI 模式在相同输入条件下应产生一致的任务结果。
2. 关键错误码与提示语在 GUI/CLI 间保持语义一致。

---

## 6. 约束与假设

1. 安装器与业务项目在同一仓库根目录下协作。
2. 用户对本地文件系统有读写权限。
3. 依赖下载能力受网络环境影响，安装器需明确提示该风险。
4. 项目允许已有本地改动，安装器不得覆盖未授权文件。
5. 本阶段优先“最小可运行”，不追求“一次安装全插件全能力”。
6. 可能存在必须人工执行的 GUI 步骤，安装器负责提示与断点恢复，不承诺全自动完成。
7. 高级配置仅作为增量能力入口，不能改变“默认最小配置可安装”的基线要求。
8. Linux 上可实现高覆盖的 all-in-one 安装体验，但不承诺“所有发行版零外部依赖”。
9. 对系统级依赖（如 libc、系统包、权限策略）采用“预检 + 指引 + 可恢复继续”策略。

---

## 7. 交付物定义

1. `VCPInstallerGUI/` 独立目录结构。
2. 需求设计文档（本文件）。
3. 后续阶段文档（待补充）：架构设计文档、任务编排设计文档、配置模型定义文档、验收与测试计划。
4. Linux AIO 设计方案：`docs/linux-aio-design.md`。

---

## 8. 里程碑（建议）

1. M1 需求冻结：确认功能边界与验收标准。
2. M2 交互原型：完成安装向导流程图与页面草图。
3. M3 最小实现：支持环境检测、组件安装、配置生成。
4. M4 稳定性增强：失败恢复、日志导出、诊断报告。
5. M5 验收发布：通过验收用例并形成用户使用说明。

---

## 9. 验收标准（初版）

1. 在受支持平台上可完成至少一个组件的完整安装闭环。
2. `VCPToolBox` 最小配置可生成，且字段校验可执行。
3. `VCPChat` 连接配置可生成并通过基本格式校验。
4. 失败安装可定位到具体步骤与具体错误信息。
5. 安装日志可导出且敏感字段已脱敏。
6. CLI 模式下，GUI 必需步骤会输出完整人工指引与 `resume` 指令。
7. 从 GUI 必需步骤中断后，可通过 `resume` 在不重复已完成步骤的前提下继续。
8. 用户在默认设置下（不进入高级配置）可完成至少一个组件的可运行安装。
9. 用户启用高级配置后，可通过“一键恢复最小配置”回到可运行状态并继续安装。
10. 在 Ubuntu 22.04+ 或 Debian 12+ 上，默认最小配置路径可完成一键安装闭环。
11. 遇到系统级缺失依赖时，安装器需输出可执行修复指引，并支持修复后 `resume` 继续。

---

## 10. 风险与待确认项

### 10.1 已识别风险

1. Linux 发行版碎片化导致依赖名、包管理器、权限策略存在差异。
2. 部分依赖安装需要外网访问，网络受限时安装成功率下降。
3. 上游项目文档与代码可能存在版本差异，需动态校验。
4. “all-in-one”若包含过多系统依赖打包，可能带来体积、更新和安全审计成本上升。

### 10.2 待确认问题

1. Linux 首发是否仅锁定 Ubuntu/Debian，还是增加 RHEL/Fedora 系支持。
2. 是否需要提供“离线安装包/本地缓存源”模式。
3. 是否允许安装器直接修改现有用户 `config.env`（或仅生成新文件）。
4. 是否需要安装后自动启动服务，还是仅提供手动启动按钮。
5. GUI 必需步骤的判定规则采用固定白名单、能力探测还是插件声明。
6. 首发高级配置覆盖哪些字段，哪些字段明确不进 GUI。

---

## 11. 下一步

1. 审阅并确认本需求文档范围与优先级。
2. 冻结 Linux 首发基线（发行版矩阵、最小可运行定义、系统依赖策略）。
3. 进入架构设计阶段（仍先文档后实现）。
